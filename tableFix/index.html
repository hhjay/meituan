<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>table fix</title>
	<style rel="stylesheet">
	*{margin:0; padding:0;}
	.bg{ width: 90%;height: 100px;margin: 20px; }
	.test{
		width: 90%; text-align: center;
		/*background: #f6f6f6;*/
		margin: 0px auto;
	}
	.fixed{ 
		position: fixed;
		display: none;
		top: 0;z-index: 9999;
	}
	.test th, .test td{
		width: 20%;
		height: 20px;
		margin: 0;
		padding: 8px;
	}
	.test tr{ border: 1px solid #eee; }
	.test th{ background: #b7b7b7; }
	.test tr:nth-child(even){
		background: #f6f6f6;
	}

	.fixtest{ 
		width: 20px;height: 20px;background: #cdc;
		position: fixed;top: 100px;right: 0;display: none; 
		text-align: center;line-height: 20px;cursor: pointer;
	}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
	<div class="bg"></div>	
	<table class="test">
		<thead>
			<tr>
				<th>aaaaaaaaa</th>
				<th>bbbbbbbbb</th>
				<th>ccccccccc</th>
				<th>ddddddddd</th>
				<th>eeeeeeeee</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr>
			<tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr><tr>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
				<td>1</td>
			</tr>
			<tr>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
				<td>2</td>
			</tr>
			<tr>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
				<td>3</td>
			</tr>
		</tbody>
	</table>
	<div class="fixtest">^</div>
	<div class="bg"></div>	
	<script type="text/javascript" >
		$(document).ready(function() {
			// var dom  = document.documentElement,
			// 	body = document.body,
			// 	win  = window;
			// var viewHeight 	 = dom.clientHeight ? dom.clientHeight : body.clientHeight,// 视图大小
			// 	thisHight    = $(".fixtest").height(),// 表格的高度
			// 	thisTop      = $(".fixtest").css("top"),
			// 	winHeight  	 = win.innerHeight,// 当前窗口大小
			// 	offsetHeight = $(".fixtest")[0].offsetTop,
			// 	nodeTop      = thisHight + parseInt(thisTop),// 滚动的位置应是 视图高＋滚动条位置
			// 	scrolltop    = win.scrollY,// 当前位置
			// 	scrollBottom = $(".fixtest").height();// 当前位置距表格结束的高度
			// 	$(window).scroll( function(event) {
			// 		console.log( win.scrollY+nodeTop >= viewHeight );
			// 		if ( win.scrollY+nodeTop >= viewHeight ) {
			// 			$(".fixtest").show();
			// 		}else{
			// 			$(".fixtest").hide();
			// 		}
			// 	});
			// 	$(".fixtest").on('click', function() {// back to top
			// 		$("body,html").animate({
			// 			scrollTop: 0
			// 		}, 500);
			// 		return false;
			// 	});

			/**
			* 表头固定的总(入口)函数
			* @fixTable 要固定表头的表格，直接传入节点 
			*/
			(function(fixTable) {
				fixTable.fn.fnFixMe = function() {
					var _this = $(this);
					var dom  = document.documentElement,// dom全局节点
						body = document.body,
						win  = window;
					var viewHeight 	 = dom.clientHeight ? dom.clientHeight : body.clientHeight,// 视图大小
						offsetHeight = _this.offsetTop,
						tScrolltop    = win.scrollY,// 当前位置

						thisFixHight    = _this.find('thead').height(),// 表格的高度
						thisTop      = _this.offset().top,
						nodeTop      = thisFixHight + parseInt(thisTop),// 滚动的位置应是 视图高＋滚动条位置
						scrollBottom = _this.height() + thisTop - thisFixHight;// 当前位置距表格结束的高度

					var tFix = _this.clone();//先clone整个表格
					tFix.find('tbody').remove();
					tFix.addClass('fixed').insertBefore(_this);

					$(window).scroll(function(event) {
						tFix.css("left", _this.offset().left);
						if ( win.scrollY >= thisTop && win.scrollY+nodeTop <= scrollBottom ) {
							tFix.show();//好像说win.scrollY不能在外面赋值，不然就不会变化
						}else{
							tFix.hide();
						}
					});
					$(window).resize(function(event) {
						tFix.css("left", _this.offset().left);
						if ( win.scrollY >= thisTop && win.scrollY+nodeTop <= scrollBottom ) {
							tFix.show();
						}else{
							tFix.hide();
						}
					});
				}
			})($);
			$(".test").fnFixMe();

		});
	</script>
</body>
</html>